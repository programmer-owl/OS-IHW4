# Макаревич Мария, БПИ228
Индивидуальное домашнее задание 3 по дисциплине "Операционные системы". **Работа выполнена на 8 баллов.**
## Вариант 3
Задача о Винни-Пухе–2 или неправильные пчелы. N пчел живет в улье. Каждая пчела может собирать мед или сторожить улей (N > 3). Пчела не покинет улей, если кроме нее в нем нет других пчел. Каждая пчела приносит за раз одну порцию меда. Всего в улей может войти тридцать порций меда. Вини-Пух спит пока меда в улье меньше половины, но как только его становится достаточно, он просыпается и пытается достать весь мед из улья. Если в улье находится меньше трех пчел, Вини-Пух забирает мед, убегает, съедает мед и снова засыпает. Если пчел три или больше, то они кусают Винни-Пуха, он убегает, лечит укус некоторое время, а затем снова бежит за медом.
Создать клиент–серверное приложение, моделирующее поведение пчел и медведя. Медведя и улей с пчелами представить в виде отдельных клиентов. Сервер обрабатывает поступающие от них сообщения и передает их клиентам в соответствии с установленными выше правилами.
## 4-5 баллов
### Алгоритм решения
В программе присутствуют 3 файла: сервер, клиент, олицетворяющий улей, и клиент, олицетворяющий Винни Пуха. Количество пчел в улье задается пользователем через командуую строку для файлов сервера и улья. Каждую пчелу олицетворяет отдельный процесс-ребенок. Все они запускаются в одном файле улья с помощью команды fork(). Тестировать программу удобнее всего при количестве пчел, равном 4. При неверном формате или содержании аргументов пользователю выводится сообщение об ошибке.

В программе улья используется объект разделяемой памяти, хранящий информацию о honey_portions - количестве порций меда в улье, а также именованный семафор bees, отвечающий за количество пчел, которые могут покинуть улей. Отметим, что из семафора bees можно также понять количество пчел, находящихся в улье, - оно равно значению семафора, увеличенному на 1, - что нужно для алгоритма кражи меда.

Пчелы на протяжении всей работы программы вылетают из улья, если у них есть такая возможность (т.е. bees != 0), через некоторое время (реализуемое вызовом команды sleep()) возвращаются в улей с медом, пополняют его запасы в улье, то есть увеличивают honey_portions, если это возможно, и на какое-то время остаются в улье, после чего процесс повторяется снова. Винни Пух наблюдает за ульем и, когда в улье накапливается достаточное количество меда (то есть honey_portions становится больше или равно 15), пытается украсть его. Далее, в зависимости от количества пчел в улье, получаемом из значения семафора bees, Винни либо опустошает улей, приравнивая honey_portions к 0, либо, покусанный пчелами, уходит лечиться, после чего процесс повторяется снова.

Взаимодействие между Винни и ульем происходит через сервер: медведь периодически посылает на сервер запросы о состоянии улья, а улей раз в определенное время (3 секунды) обновляет на сервере информацию о своем состоянии. Для передачи информации между сервером и клиентами используется протокол UDP. Адреса сервера и портов, как и количество пчел, передаются через командную строку: <Number of bees greater than 3> <Server Port\> для server.c, <Server IP\> <Number of bees greater than 3> \[<Echo Port\>] для hive.c и <Server IP\> \[<Echo Port\>] для bear.c. В начале работы программы сервер запоминает адреса улья и медведя, и далее использует их для отправки сообщений.

В программе предусмотрено ее корректное завершение с удалением разделяемой памяти и семафоров по прерыванию с клавиатуры, то есть при команде SIGINT.
### Пример работы программы
server.c ничего не выводит, просто молча работает.

**hive.c**

![image](https://github.com/programmer-owl/OS-IHW4/assets/131264233/a8590103-d95e-4856-8659-dd63bc02fd54)

(это надолго, перейдем к интересной части)

![image](https://github.com/programmer-owl/OS-IHW4/assets/131264233/9caa0976-1d57-425e-9371-ec16dd080e89)


**bear.c**

![image](https://github.com/programmer-owl/OS-IHW4/assets/131264233/de1fe106-1751-4045-8d7b-8729bb3724c8)


## 6-7 баллов
### Алгоритм решения
В программу добавлен файл monitor.c, выводящий в консоль все присходящие события, о которых ему сообщает сервер. Его слудеут вызывать с аргументами в командой строке: <Server IP\> \[<Echo Port\>]. При этом вывод информации о пчелах сокращен, ибо на предыдущем пункте я поняла, что ее слишком много, и это сбивает пользователя. Я заменила вывод информации в программе сервера на вывод ее в программе монитора, а также добавила к ней информацию о состоянии улья. Основные модификации были проведены с файлом server.c, в котором вызовы функции printf были заменены на отправку сообщений монитору.
### Пример работы программы
**monitor.c**


## 8 баллов
В программу добавлена возможность подключать несколько мониторов (но их число ограничено мной как разработчиком - максимум 1024). Это реализовано с помощью добавления в разделяемую память hive_data полей: списка сокетов клиентов и id следующего свободного места в списке. При вызове функции notifyMonitors программа проходится по списку и пытается отправить информацию всем ненулевым элементам. При неудачной отправке элемент списка обнуляется, и работа с данным монитором завершается. Файл монитора был незначительно изменен, чтобы сокеты мониторов не являлись блокирующими. Файлы пчел и медведя не изменились. Скрины демонстрации программы не прикладываю, ибо они ничем не отличаются от предыдущего пункта, ну разве что количеством мониторов. А еще у меня просто осталось 5 минут, помогите...


